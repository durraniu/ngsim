---
title: "Transform Data"
date: "2024-01-20"
categories: [import, transform, dplyr, pandas, polars, arrow, janitor]
image: "trajectories.gif"
code-annotations: hover
engine: knitr
---

```{r setup}
#| echo: false
reticulate::use_python("C:\\Users\\umair\\AppData\\Local\\Programs\\Python\\Python312\\python.exe")
```


```{r}
#| eval: false

library(arrow)
library(dplyr)

path_to_partitioned_first_period_file <- "D:/ngsim/posts/import/data/I80/period=first/part-0.parquet"

open_dataset(path_to_partitioned_first_period_file) |>
  dplyr::collect() |>
  arrow::write_parquet(sink = "data/i80_period1.parquet")
```


## Load parquet file 

::: {.panel-tabset group="language"}
### R
```{r rread}
library(arrow)
library(dplyr)

path_to_first_period_file <- "data/i80_period1.parquet"
data_R <- arrow::read_parquet(file = path_to_first_period_file)

data_R
```

### Python
```{python pyread}
import polars as pl

path_to_first_period_file = "data/i80_period1.parquet"
data_py = pl.read_parquet(path_to_first_period_file)

data_py.head()
```
:::


## Clean dataframe names

::: {.panel-tabset group="language"}
### R
```{r rclean}
library(janitor)
data_R <- janitor::clean_names(data_R) 
```

### Python
```{python pyclean}
import pandas as pd
import pyarrow
import janitor
data_py = data_py.to_pandas()
data_py = data_py.clean_names()

data_py.head()
```
:::


## How to create a time column?

::: {.panel-tabset group="language"}
### R
```{r rtime1}
library(lubridate)

data_R <- data_R |>
  dplyr::mutate(actual_time = lubridate::as_datetime(global_time / 1000, 
    origin = "1970-01-01",
    tz = "America/Los_Angeles"
  ))
```


```{r rtime2}
data_R <- data_R |> 
  group_by(vehicle_id) |> 
  mutate(time = (0:(n()-1))/10) |> 
  ungroup()

head(data_R)
```



### Python
```{python pytime1}

```
:::