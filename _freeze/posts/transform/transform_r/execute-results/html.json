{
  "hash": "ddf7010b667a603be80d300b86d9df1d",
  "result": {
    "markdown": "---\ntitle: \"Transform Data with R\"\ndate: \"2024-01-21\"\ncategories: [import, transform, dplyr, arrow, janitor]\nimage: \"speed_plot.PNG\"\ncode-annotations: hover\nengine: knitr\n---\n\n\n::: {.callout-note}\nThis is the second post in the NGSIM data analysis series. Previous post:   \n\n* [Import data](https://itav-ngsim.netlify.app/posts/import/import)  \n\n:::\n\n\n::: {.callout-tip}\n## After completing this post, you will be able to:\n\n* Read parquet files  \n* Do a quick clean-up of column names    \n* Convert integer time to datetime fromat  \n* Sort data by columns  \n* Create new columns  \n* Remove undesired columns  \n* Filter data  \n* Create this little animation of a car following another car:  \n   ![](car_following.gif){width=75%}\n    \n:::\n\n[This post shows code in `R`. You can see the same post written in `Python` [here](transform_py.qmd).]{.aside}\n\nIn the previous post, we partitioned the Interstate 80 (I80) vehicle trajectories data by time and then saved it on disk:  \n\n![](i80_period.PNG)  \n\nWe now make use of the parquet file in the `period=first` directory for learning to transform data. Since this file is part of partitioned data, I saved it as a separate parquet file in a different location as shown below:  \n\n[You may read the partitioned parquet file also, but R and Python load it slightly differently.]{.aside}  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(arrow)\nlibrary(dplyr)\n\npath_to_partitioned_first_period_file <- \"D:/ngsim/posts/import/data/I80/period=first/part-0.parquet\"\n\nopen_dataset(path_to_partitioned_first_period_file) |> # <1>\n  dplyr::collect() |> # <2>\n  arrow::write_parquet(sink = \"data/i80_period1.parquet\") # <3>\n```\n:::\n\n1. Open the `part-0.parquet`.   \n2. Load it into memory.    \n3. Save it as `i80_period1.parquet` under the `data` directory.  \n\n\n\nNow, we read the `i80_period1.parquet` file:  \n\n## Load parquet file \n\nReading the parquet file requires the `arrow` package:  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(arrow)\nlibrary(dplyr)\n\npath_to_first_period_file <- \"data/i80_period1.parquet\"\ndata_R <- arrow::read_parquet(file = path_to_first_period_file)\n\nhead(data_R)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Vehicle_ID\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Frame_ID\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Total_Frames\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Global_Time\"],\"name\":[4],\"type\":[\"int64\"],\"align\":[\"right\"]},{\"label\":[\"Local_X\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Local_Y\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Global_X\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Global_Y\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_length\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_Width\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_Class\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"v_Vel\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_Acc\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Lane_ID\"],\"name\":[14],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"O_Zone\"],\"name\":[15],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"D_Zone\"],\"name\":[16],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Int_ID\"],\"name\":[17],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Section_ID\"],\"name\":[18],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Direction\"],\"name\":[19],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Movement\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Preceding\"],\"name\":[21],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Following\"],\"name\":[22],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Space_Headway\"],\"name\":[23],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Time_Headway\"],\"name\":[24],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"3027\",\"2\":\"8493\",\"3\":\"813\",\"4\":\"1113433984200\",\"5\":\"53.115\",\"6\":\"363.266\",\"7\":\"6042839\",\"8\":\"2133435\",\"9\":\"15.3\",\"10\":\"7.4\",\"11\":\"2\",\"12\":\"21.46\",\"13\":\"-8.14\",\"14\":\"5\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3014\",\"22\":\"3032\",\"23\":\"64.23\",\"24\":\"2.99\"},{\"1\":\"3214\",\"2\":\"9115\",\"3\":\"708\",\"4\":\"1113434046400\",\"5\":\"67.931\",\"6\":\"655.629\",\"7\":\"6042818\",\"8\":\"2133727\",\"9\":\"13.8\",\"10\":\"6.3\",\"11\":\"2\",\"12\":\"15.37\",\"13\":\"11.20\",\"14\":\"6\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3221\",\"22\":\"3229\",\"23\":\"31.71\",\"24\":\"2.06\"},{\"1\":\"3199\",\"2\":\"9329\",\"3\":\"575\",\"4\":\"1113434067800\",\"5\":\"17.026\",\"6\":\"1237.592\",\"7\":\"6042683\",\"8\":\"2134297\",\"9\":\"14.4\",\"10\":\"5.9\",\"11\":\"2\",\"12\":\"39.30\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3188\",\"22\":\"3206\",\"23\":\"72.36\",\"24\":\"1.84\"},{\"1\":\"3159\",\"2\":\"8919\",\"3\":\"572\",\"4\":\"1113434026800\",\"5\":\"16.541\",\"6\":\"306.905\",\"7\":\"6042810\",\"8\":\"2133374\",\"9\":\"16.4\",\"10\":\"5.9\",\"11\":\"2\",\"12\":\"14.71\",\"13\":\"3.61\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3152\",\"22\":\"3171\",\"23\":\"51.90\",\"24\":\"3.53\"},{\"1\":\"3314\",\"2\":\"9324\",\"3\":\"616\",\"4\":\"1113434067300\",\"5\":\"28.846\",\"6\":\"65.807\",\"7\":\"6042852\",\"8\":\"2133137\",\"9\":\"14.8\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"36.24\",\"13\":\"0.00\",\"14\":\"3\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3301\",\"22\":\"0\",\"23\":\"103.26\",\"24\":\"2.85\"},{\"1\":\"3128\",\"2\":\"9052\",\"3\":\"603\",\"4\":\"1113434040100\",\"5\":\"17.270\",\"6\":\"920.719\",\"7\":\"6042732\",\"8\":\"2133984\",\"9\":\"16.8\",\"10\":\"8.5\",\"11\":\"2\",\"12\":\"35.69\",\"13\":\"11.20\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3125\",\"22\":\"3132\",\"23\":\"90.81\",\"24\":\"2.54\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n## Clean dataframe names\n\nAs you can see above, the column names are in good shape i.e., without any spaces. However, it is easier typing lowercase letters than the sentence case. So, we use the `clean_names` function from the `janitor` package to make all column names lowercase. If the column names have spaces or periods in them, `clean_names` would replace them with underscores.   \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(janitor)\ndata_R <- janitor::clean_names(data_R) \n\nhead(data_R)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"vehicle_id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"frame_id\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"total_frames\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"global_time\"],\"name\":[4],\"type\":[\"int64\"],\"align\":[\"right\"]},{\"label\":[\"local_x\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"local_y\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"global_x\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"global_y\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_length\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_width\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_class\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"v_vel\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_acc\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lane_id\"],\"name\":[14],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"o_zone\"],\"name\":[15],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"d_zone\"],\"name\":[16],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"int_id\"],\"name\":[17],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"section_id\"],\"name\":[18],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"direction\"],\"name\":[19],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"movement\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"preceding\"],\"name\":[21],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"following\"],\"name\":[22],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"space_headway\"],\"name\":[23],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"time_headway\"],\"name\":[24],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"3027\",\"2\":\"8493\",\"3\":\"813\",\"4\":\"1113433984200\",\"5\":\"53.115\",\"6\":\"363.266\",\"7\":\"6042839\",\"8\":\"2133435\",\"9\":\"15.3\",\"10\":\"7.4\",\"11\":\"2\",\"12\":\"21.46\",\"13\":\"-8.14\",\"14\":\"5\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3014\",\"22\":\"3032\",\"23\":\"64.23\",\"24\":\"2.99\"},{\"1\":\"3214\",\"2\":\"9115\",\"3\":\"708\",\"4\":\"1113434046400\",\"5\":\"67.931\",\"6\":\"655.629\",\"7\":\"6042818\",\"8\":\"2133727\",\"9\":\"13.8\",\"10\":\"6.3\",\"11\":\"2\",\"12\":\"15.37\",\"13\":\"11.20\",\"14\":\"6\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3221\",\"22\":\"3229\",\"23\":\"31.71\",\"24\":\"2.06\"},{\"1\":\"3199\",\"2\":\"9329\",\"3\":\"575\",\"4\":\"1113434067800\",\"5\":\"17.026\",\"6\":\"1237.592\",\"7\":\"6042683\",\"8\":\"2134297\",\"9\":\"14.4\",\"10\":\"5.9\",\"11\":\"2\",\"12\":\"39.30\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3188\",\"22\":\"3206\",\"23\":\"72.36\",\"24\":\"1.84\"},{\"1\":\"3159\",\"2\":\"8919\",\"3\":\"572\",\"4\":\"1113434026800\",\"5\":\"16.541\",\"6\":\"306.905\",\"7\":\"6042810\",\"8\":\"2133374\",\"9\":\"16.4\",\"10\":\"5.9\",\"11\":\"2\",\"12\":\"14.71\",\"13\":\"3.61\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3152\",\"22\":\"3171\",\"23\":\"51.90\",\"24\":\"3.53\"},{\"1\":\"3314\",\"2\":\"9324\",\"3\":\"616\",\"4\":\"1113434067300\",\"5\":\"28.846\",\"6\":\"65.807\",\"7\":\"6042852\",\"8\":\"2133137\",\"9\":\"14.8\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"36.24\",\"13\":\"0.00\",\"14\":\"3\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3301\",\"22\":\"0\",\"23\":\"103.26\",\"24\":\"2.85\"},{\"1\":\"3128\",\"2\":\"9052\",\"3\":\"603\",\"4\":\"1113434040100\",\"5\":\"17.270\",\"6\":\"920.719\",\"7\":\"6042732\",\"8\":\"2133984\",\"9\":\"16.8\",\"10\":\"8.5\",\"11\":\"2\",\"12\":\"35.69\",\"13\":\"11.20\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3125\",\"22\":\"3132\",\"23\":\"90.81\",\"24\":\"2.54\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n## How to create a time column?\n\nSince vehicle trajectories change over time, it is nice to see these changes over different time periods. However, the `gloabl_time` column in this dataset contains integers rather than the actual time. So, we create a new column called `actual_time` by dividing the `global_time` by 1000 and converting it to a datetime object.  \n\nIn R, this can be done via `lubridate::as_datetime`. Note that we specify the time zone to be `America/Los_Angeles`.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lubridate)\n\ndata_R <- data_R |>\n  dplyr::mutate(actual_time = lubridate::as_datetime(global_time / 1000, \n    origin = \"1970-01-01\",\n    tz = \"America/Los_Angeles\"\n  ))\n\nhead(data_R)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"vehicle_id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"frame_id\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"total_frames\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"global_time\"],\"name\":[4],\"type\":[\"int64\"],\"align\":[\"right\"]},{\"label\":[\"local_x\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"local_y\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"global_x\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"global_y\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_length\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_width\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_class\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"v_vel\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_acc\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lane_id\"],\"name\":[14],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"o_zone\"],\"name\":[15],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"d_zone\"],\"name\":[16],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"int_id\"],\"name\":[17],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"section_id\"],\"name\":[18],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"direction\"],\"name\":[19],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"movement\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"preceding\"],\"name\":[21],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"following\"],\"name\":[22],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"space_headway\"],\"name\":[23],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"time_headway\"],\"name\":[24],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"actual_time\"],\"name\":[25],\"type\":[\"dttm\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"3027\",\"2\":\"8493\",\"3\":\"813\",\"4\":\"1113433984200\",\"5\":\"53.115\",\"6\":\"363.266\",\"7\":\"6042839\",\"8\":\"2133435\",\"9\":\"15.3\",\"10\":\"7.4\",\"11\":\"2\",\"12\":\"21.46\",\"13\":\"-8.14\",\"14\":\"5\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3014\",\"22\":\"3032\",\"23\":\"64.23\",\"24\":\"2.99\",\"25\":\"2005-04-13 16:13:04.2\"},{\"1\":\"3214\",\"2\":\"9115\",\"3\":\"708\",\"4\":\"1113434046400\",\"5\":\"67.931\",\"6\":\"655.629\",\"7\":\"6042818\",\"8\":\"2133727\",\"9\":\"13.8\",\"10\":\"6.3\",\"11\":\"2\",\"12\":\"15.37\",\"13\":\"11.20\",\"14\":\"6\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3221\",\"22\":\"3229\",\"23\":\"31.71\",\"24\":\"2.06\",\"25\":\"2005-04-13 16:14:06.4\"},{\"1\":\"3199\",\"2\":\"9329\",\"3\":\"575\",\"4\":\"1113434067800\",\"5\":\"17.026\",\"6\":\"1237.592\",\"7\":\"6042683\",\"8\":\"2134297\",\"9\":\"14.4\",\"10\":\"5.9\",\"11\":\"2\",\"12\":\"39.30\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3188\",\"22\":\"3206\",\"23\":\"72.36\",\"24\":\"1.84\",\"25\":\"2005-04-13 16:14:27.7\"},{\"1\":\"3159\",\"2\":\"8919\",\"3\":\"572\",\"4\":\"1113434026800\",\"5\":\"16.541\",\"6\":\"306.905\",\"7\":\"6042810\",\"8\":\"2133374\",\"9\":\"16.4\",\"10\":\"5.9\",\"11\":\"2\",\"12\":\"14.71\",\"13\":\"3.61\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3152\",\"22\":\"3171\",\"23\":\"51.90\",\"24\":\"3.53\",\"25\":\"2005-04-13 16:13:46.7\"},{\"1\":\"3314\",\"2\":\"9324\",\"3\":\"616\",\"4\":\"1113434067300\",\"5\":\"28.846\",\"6\":\"65.807\",\"7\":\"6042852\",\"8\":\"2133137\",\"9\":\"14.8\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"36.24\",\"13\":\"0.00\",\"14\":\"3\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3301\",\"22\":\"0\",\"23\":\"103.26\",\"24\":\"2.85\",\"25\":\"2005-04-13 16:14:27.2\"},{\"1\":\"3128\",\"2\":\"9052\",\"3\":\"603\",\"4\":\"1113434040100\",\"5\":\"17.270\",\"6\":\"920.719\",\"7\":\"6042732\",\"8\":\"2133984\",\"9\":\"16.8\",\"10\":\"8.5\",\"11\":\"2\",\"12\":\"35.69\",\"13\":\"11.20\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"3125\",\"22\":\"3132\",\"23\":\"90.81\",\"24\":\"2.54\",\"25\":\"2005-04-13 16:14:00.0\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nNote that the data is not in the correct order. The `vehicle_id`s in the first two rows are 3027 and 3214. However, we know that the same vehicle was observed for several seconds. This means that we should see a given `vehicle_id` repeated over multiple rows consecutively. We therefore sort by `vehicle_id` and `frame_id`:  \n\n\n::: {.cell}\n\n```{.r .cell-code}\n## First: Sort by Vehicle ID and Time\ndata_R <- data_R |> \n  dplyr::arrange(vehicle_id, frame_id)\n\nhead(data_R)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"vehicle_id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"frame_id\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"total_frames\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"global_time\"],\"name\":[4],\"type\":[\"int64\"],\"align\":[\"right\"]},{\"label\":[\"local_x\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"local_y\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"global_x\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"global_y\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_length\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_width\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_class\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"v_vel\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_acc\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lane_id\"],\"name\":[14],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"o_zone\"],\"name\":[15],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"d_zone\"],\"name\":[16],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"int_id\"],\"name\":[17],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"section_id\"],\"name\":[18],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"direction\"],\"name\":[19],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"movement\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"preceding\"],\"name\":[21],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"following\"],\"name\":[22],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"space_headway\"],\"name\":[23],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"time_headway\"],\"name\":[24],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"actual_time\"],\"name\":[25],\"type\":[\"dttm\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"12\",\"3\":\"884\",\"4\":\"1113433136100\",\"5\":\"16.884\",\"6\":\"48.213\",\"7\":\"6042842\",\"8\":\"2133118\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.50\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.0\"},{\"1\":\"1\",\"2\":\"13\",\"3\":\"884\",\"4\":\"1113433136200\",\"5\":\"16.938\",\"6\":\"49.463\",\"7\":\"6042842\",\"8\":\"2133119\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.50\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.2\"},{\"1\":\"1\",\"2\":\"14\",\"3\":\"884\",\"4\":\"1113433136300\",\"5\":\"16.991\",\"6\":\"50.712\",\"7\":\"6042842\",\"8\":\"2133120\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.50\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.2\"},{\"1\":\"1\",\"2\":\"15\",\"3\":\"884\",\"4\":\"1113433136400\",\"5\":\"17.045\",\"6\":\"51.963\",\"7\":\"6042842\",\"8\":\"2133121\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.50\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.4\"},{\"1\":\"1\",\"2\":\"16\",\"3\":\"884\",\"4\":\"1113433136500\",\"5\":\"17.098\",\"6\":\"53.213\",\"7\":\"6042842\",\"8\":\"2133123\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.50\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.5\"},{\"1\":\"1\",\"2\":\"17\",\"3\":\"884\",\"4\":\"1113433136600\",\"5\":\"17.151\",\"6\":\"54.463\",\"7\":\"6042842\",\"8\":\"2133124\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.49\",\"13\":\"-0.09\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.5\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nWhen we want to compare several vehicle trajectories, e.g., how their speeds change over time regardless of when they were observed, we'd want a common time scale. The NGSIM documentation describes that vehicles were observed at a resolution of 0.1 seconds. So, we can create a`time` variable for each vehicle that starts at 0 and ends at (n-1)/10 where n = number of rows for which a `vehicle_id` is repeated:  \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_R <- data_R |> \n  dplyr::group_by(vehicle_id) |>   # <1> \n  dplyr::mutate(time = (0:(dplyr::n()-1))/10) |>  # <2>\n  dplyr::ungroup() # <3>\n\nhead(data_R)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"vehicle_id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"frame_id\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"total_frames\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"global_time\"],\"name\":[4],\"type\":[\"int64\"],\"align\":[\"right\"]},{\"label\":[\"local_x\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"local_y\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"global_x\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"global_y\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_length\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_width\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_class\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"v_vel\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_acc\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lane_id\"],\"name\":[14],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"o_zone\"],\"name\":[15],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"d_zone\"],\"name\":[16],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"int_id\"],\"name\":[17],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"section_id\"],\"name\":[18],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"direction\"],\"name\":[19],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"movement\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"preceding\"],\"name\":[21],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"following\"],\"name\":[22],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"space_headway\"],\"name\":[23],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"time_headway\"],\"name\":[24],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"actual_time\"],\"name\":[25],\"type\":[\"dttm\"],\"align\":[\"right\"]},{\"label\":[\"time\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"12\",\"3\":\"884\",\"4\":\"1113433136100\",\"5\":\"16.884\",\"6\":\"48.213\",\"7\":\"6042842\",\"8\":\"2133118\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.50\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.0\",\"26\":\"0.0\"},{\"1\":\"1\",\"2\":\"13\",\"3\":\"884\",\"4\":\"1113433136200\",\"5\":\"16.938\",\"6\":\"49.463\",\"7\":\"6042842\",\"8\":\"2133119\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.50\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.2\",\"26\":\"0.1\"},{\"1\":\"1\",\"2\":\"14\",\"3\":\"884\",\"4\":\"1113433136300\",\"5\":\"16.991\",\"6\":\"50.712\",\"7\":\"6042842\",\"8\":\"2133120\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.50\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.2\",\"26\":\"0.2\"},{\"1\":\"1\",\"2\":\"15\",\"3\":\"884\",\"4\":\"1113433136400\",\"5\":\"17.045\",\"6\":\"51.963\",\"7\":\"6042842\",\"8\":\"2133121\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.50\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.4\",\"26\":\"0.3\"},{\"1\":\"1\",\"2\":\"16\",\"3\":\"884\",\"4\":\"1113433136500\",\"5\":\"17.098\",\"6\":\"53.213\",\"7\":\"6042842\",\"8\":\"2133123\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.50\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.5\",\"26\":\"0.4\"},{\"1\":\"1\",\"2\":\"17\",\"3\":\"884\",\"4\":\"1113433136600\",\"5\":\"17.151\",\"6\":\"54.463\",\"7\":\"6042842\",\"8\":\"2133124\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.49\",\"13\":\"-0.09\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.5\",\"26\":\"0.5\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n1. Group by `vehicle_id` so that `time` is calculated for each vehicle separately.  \n2. `dplyr::n()` gives the group size.  \n3. Don't forget to `ungroup`.  \n\n\n\n## How to create variables for the preceding vehicle?\n\nWe'd often need velocity, acceleration, and other variables for the preceding vehicle (vehicle in front of the subject vehicle). These variables can be useful in car-following modeling.   \n\nIn this dataset, preceding vehicle variables do not exist as separate columns. The only relevant column is `preceding` which is the identifier of the preceding vehicle. But the data also contains the subject vehicle identifier `vehicle_id`, along with these variables:  \n\n* `local_y`: longitudinal position of the front end of the subject vehicle (feet)     \n* `local_x`: lateral position of the front end of the subject vehicle (feet)  \n* `v_length` and `v_width` are the length and width of the subject vehicle (feet)  \n* `v_class` is the class of the subject vehicle, i.e., 1 = motorcycle, 2 = car, and 3 = heavy vehicle (bus/truck)  \n* `v_vel` and `v_acc` are the velocity (ft/s) and acceleration (ft/s/s) of the subject vehicle  \n\nOur goal now is to create new columns of the above variables for the preceding vehicle. To this end, we look for the value of `preceding` in the `vehicle_id` column at a given value of `frame_id` (identifier of time frame) and then grab the value of variable e.g., `v_vel` at that `frame_id`:  \n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Create new cols\ndata_R <- data_R |> \n  dplyr::group_by(frame_id) |>  # <1>\n  dplyr::mutate(preceding_local_y = local_y[match(preceding, vehicle_id)], # <2>\n                preceding_local_x = local_x[match(preceding, vehicle_id)],\n                preceding_length = v_length[match(preceding, vehicle_id)],\n                preceding_width = v_width[match(preceding, vehicle_id)],\n                preceding_class = v_class[match(preceding, vehicle_id)],\n                preceding_vel = v_vel[match(preceding, vehicle_id)],\n                preceding_acc = v_acc[match(preceding, vehicle_id)]) |> \n  dplyr::ungroup()\n\nhead(data_R)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"vehicle_id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"frame_id\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"total_frames\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"global_time\"],\"name\":[4],\"type\":[\"int64\"],\"align\":[\"right\"]},{\"label\":[\"local_x\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"local_y\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"global_x\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"global_y\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_length\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_width\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_class\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"v_vel\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_acc\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lane_id\"],\"name\":[14],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"o_zone\"],\"name\":[15],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"d_zone\"],\"name\":[16],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"int_id\"],\"name\":[17],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"section_id\"],\"name\":[18],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"direction\"],\"name\":[19],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"movement\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"preceding\"],\"name\":[21],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"following\"],\"name\":[22],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"space_headway\"],\"name\":[23],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"time_headway\"],\"name\":[24],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"actual_time\"],\"name\":[25],\"type\":[\"dttm\"],\"align\":[\"right\"]},{\"label\":[\"time\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_local_y\"],\"name\":[27],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_local_x\"],\"name\":[28],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_length\"],\"name\":[29],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_width\"],\"name\":[30],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_class\"],\"name\":[31],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"preceding_vel\"],\"name\":[32],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_acc\"],\"name\":[33],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"12\",\"3\":\"884\",\"4\":\"1113433136100\",\"5\":\"16.884\",\"6\":\"48.213\",\"7\":\"6042842\",\"8\":\"2133118\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.50\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.0\",\"26\":\"0.0\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"NA\",\"31\":\"NA\",\"32\":\"NA\",\"33\":\"NA\"},{\"1\":\"1\",\"2\":\"13\",\"3\":\"884\",\"4\":\"1113433136200\",\"5\":\"16.938\",\"6\":\"49.463\",\"7\":\"6042842\",\"8\":\"2133119\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.50\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.2\",\"26\":\"0.1\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"NA\",\"31\":\"NA\",\"32\":\"NA\",\"33\":\"NA\"},{\"1\":\"1\",\"2\":\"14\",\"3\":\"884\",\"4\":\"1113433136300\",\"5\":\"16.991\",\"6\":\"50.712\",\"7\":\"6042842\",\"8\":\"2133120\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.50\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.2\",\"26\":\"0.2\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"NA\",\"31\":\"NA\",\"32\":\"NA\",\"33\":\"NA\"},{\"1\":\"1\",\"2\":\"15\",\"3\":\"884\",\"4\":\"1113433136400\",\"5\":\"17.045\",\"6\":\"51.963\",\"7\":\"6042842\",\"8\":\"2133121\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.50\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.4\",\"26\":\"0.3\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"NA\",\"31\":\"NA\",\"32\":\"NA\",\"33\":\"NA\"},{\"1\":\"1\",\"2\":\"16\",\"3\":\"884\",\"4\":\"1113433136500\",\"5\":\"17.098\",\"6\":\"53.213\",\"7\":\"6042842\",\"8\":\"2133123\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.50\",\"13\":\"0.00\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.5\",\"26\":\"0.4\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"NA\",\"31\":\"NA\",\"32\":\"NA\",\"33\":\"NA\"},{\"1\":\"1\",\"2\":\"17\",\"3\":\"884\",\"4\":\"1113433136600\",\"5\":\"17.151\",\"6\":\"54.463\",\"7\":\"6042842\",\"8\":\"2133124\",\"9\":\"14.3\",\"10\":\"6.4\",\"11\":\"2\",\"12\":\"12.49\",\"13\":\"-0.09\",\"14\":\"2\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"2005-04-13 15:58:56.5\",\"26\":\"0.5\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"NA\",\"31\":\"NA\",\"32\":\"NA\",\"33\":\"NA\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n1. Grouping by time using `frame_id`.  \n2. `match` function matches the values of `preceding` to `vehicle_id` and provide the positions of these matches. Then we use the `<VAR>[]` syntax to grab the value of a variable (where `<VAR>` means the variable of interest e.g., `v_vel`).  \n\nA `NA` value indicates missing value. In this dataset, `NA` indicates that the value is missing because there was no preceding vehicle observed. For `vehicle_id` 1 we can see this is true because the `preceding` value is 0.  \n\n\n\n## How to remove undesired columns?\n\nThere are several variables in this dataset that we don't need as they are completely devoid of any value. So we remove them:  \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_R <- data_R |>\n  select(-c(total_frames, starts_with(\"global\"), following, \n            o_zone, d_zone, int_id, section_id, direction, \n            movement), global_time) \n\nhead(data_R)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"vehicle_id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"frame_id\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"local_x\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"local_y\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_length\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_width\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_class\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"v_vel\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_acc\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lane_id\"],\"name\":[10],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"preceding\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"space_headway\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"time_headway\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"actual_time\"],\"name\":[14],\"type\":[\"dttm\"],\"align\":[\"right\"]},{\"label\":[\"time\"],\"name\":[15],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_local_y\"],\"name\":[16],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_local_x\"],\"name\":[17],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_length\"],\"name\":[18],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_width\"],\"name\":[19],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_class\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"preceding_vel\"],\"name\":[21],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_acc\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"global_time\"],\"name\":[23],\"type\":[\"int64\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"12\",\"3\":\"16.884\",\"4\":\"48.213\",\"5\":\"14.3\",\"6\":\"6.4\",\"7\":\"2\",\"8\":\"12.50\",\"9\":\"0.00\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.0\",\"15\":\"0.0\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136100\"},{\"1\":\"1\",\"2\":\"13\",\"3\":\"16.938\",\"4\":\"49.463\",\"5\":\"14.3\",\"6\":\"6.4\",\"7\":\"2\",\"8\":\"12.50\",\"9\":\"0.00\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.2\",\"15\":\"0.1\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136200\"},{\"1\":\"1\",\"2\":\"14\",\"3\":\"16.991\",\"4\":\"50.712\",\"5\":\"14.3\",\"6\":\"6.4\",\"7\":\"2\",\"8\":\"12.50\",\"9\":\"0.00\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.2\",\"15\":\"0.2\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136300\"},{\"1\":\"1\",\"2\":\"15\",\"3\":\"17.045\",\"4\":\"51.963\",\"5\":\"14.3\",\"6\":\"6.4\",\"7\":\"2\",\"8\":\"12.50\",\"9\":\"0.00\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.4\",\"15\":\"0.3\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136400\"},{\"1\":\"1\",\"2\":\"16\",\"3\":\"17.098\",\"4\":\"53.213\",\"5\":\"14.3\",\"6\":\"6.4\",\"7\":\"2\",\"8\":\"12.50\",\"9\":\"0.00\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.5\",\"15\":\"0.4\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136500\"},{\"1\":\"1\",\"2\":\"17\",\"3\":\"17.151\",\"4\":\"54.463\",\"5\":\"14.3\",\"6\":\"6.4\",\"7\":\"2\",\"8\":\"12.49\",\"9\":\"-0.09\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.5\",\"15\":\"0.5\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136600\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\n## How to transform multiple columns?\n\n### Metric units\n\n![](https://media.giphy.com/media/xUPGcAx3wr7jszFfpe/giphy.gif)\n\nAs discussed before, variables in this dataset have imperial units (feet, ft/s, etc.). You may want to transform the values of these variables to metric units. The conversion factor is 0.3048. Here, we utilize the `across` function to take all the desired columns and apply the conversion factor along with rounding to 2 decimal places:  \n\n\n::: {.cell}\n\n```{.r .cell-code}\n## metric units\ndata_R <- data_R |> \n  dplyr::mutate(dplyr::across(\n    .cols = c(dplyr::starts_with(\"local\"), dplyr::starts_with(\"v_\"), space_headway, dplyr::starts_with(\"preceding\"), -preceding, -preceding_class, -v_class),\n    .fns = ~ round(.x * .3048, 2)\n  ))\n\nhead(data_R)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"vehicle_id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"frame_id\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"local_x\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"local_y\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_length\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_width\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_class\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"v_vel\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_acc\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lane_id\"],\"name\":[10],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"preceding\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"space_headway\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"time_headway\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"actual_time\"],\"name\":[14],\"type\":[\"dttm\"],\"align\":[\"right\"]},{\"label\":[\"time\"],\"name\":[15],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_local_y\"],\"name\":[16],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_local_x\"],\"name\":[17],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_length\"],\"name\":[18],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_width\"],\"name\":[19],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_class\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"preceding_vel\"],\"name\":[21],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_acc\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"global_time\"],\"name\":[23],\"type\":[\"int64\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"12\",\"3\":\"5.15\",\"4\":\"14.70\",\"5\":\"4.36\",\"6\":\"1.95\",\"7\":\"2\",\"8\":\"3.81\",\"9\":\"0.00\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.0\",\"15\":\"0.0\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136100\"},{\"1\":\"1\",\"2\":\"13\",\"3\":\"5.16\",\"4\":\"15.08\",\"5\":\"4.36\",\"6\":\"1.95\",\"7\":\"2\",\"8\":\"3.81\",\"9\":\"0.00\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.2\",\"15\":\"0.1\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136200\"},{\"1\":\"1\",\"2\":\"14\",\"3\":\"5.18\",\"4\":\"15.46\",\"5\":\"4.36\",\"6\":\"1.95\",\"7\":\"2\",\"8\":\"3.81\",\"9\":\"0.00\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.2\",\"15\":\"0.2\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136300\"},{\"1\":\"1\",\"2\":\"15\",\"3\":\"5.20\",\"4\":\"15.84\",\"5\":\"4.36\",\"6\":\"1.95\",\"7\":\"2\",\"8\":\"3.81\",\"9\":\"0.00\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.4\",\"15\":\"0.3\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136400\"},{\"1\":\"1\",\"2\":\"16\",\"3\":\"5.21\",\"4\":\"16.22\",\"5\":\"4.36\",\"6\":\"1.95\",\"7\":\"2\",\"8\":\"3.81\",\"9\":\"0.00\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.5\",\"15\":\"0.4\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136500\"},{\"1\":\"1\",\"2\":\"17\",\"3\":\"5.23\",\"4\":\"16.60\",\"5\":\"4.36\",\"6\":\"1.95\",\"7\":\"2\",\"8\":\"3.81\",\"9\":\"-0.03\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.5\",\"15\":\"0.5\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136600\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### Convert numbers/strings to categorical data type\n\nMoreover, we know that there are variables that should be treated as categorical (qualitative) rather than numbers or strings. For instance, `lane_id` has values 1-7 and we know that these are identifiers for lanes. Similarly, the class of a vehicle is encoded as 1, 2, and 3 but we know that these numbers do not have any quantitaive information, rather they are categories.   \n\nIn R, categorical data is encoded as `factor` data type. So, we use the `as.factor` function to convert numbers/strings to factor data type:    \n\n\n::: {.cell}\n\n```{.r .cell-code}\n## factor type\ndata_R <- data_R |> \n  mutate(across(\n  .cols = c(vehicle_id, v_class, lane_id, preceding, preceding_class),\n  .fns = ~ as.factor(.x)\n))\n\nhead(data_R)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"vehicle_id\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"frame_id\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"local_x\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"local_y\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_length\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_width\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_class\"],\"name\":[7],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"v_vel\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v_acc\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lane_id\"],\"name\":[10],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"preceding\"],\"name\":[11],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"space_headway\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"time_headway\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"actual_time\"],\"name\":[14],\"type\":[\"dttm\"],\"align\":[\"right\"]},{\"label\":[\"time\"],\"name\":[15],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_local_y\"],\"name\":[16],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_local_x\"],\"name\":[17],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_length\"],\"name\":[18],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_width\"],\"name\":[19],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_class\"],\"name\":[20],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"preceding_vel\"],\"name\":[21],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"preceding_acc\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"global_time\"],\"name\":[23],\"type\":[\"int64\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"12\",\"3\":\"5.15\",\"4\":\"14.70\",\"5\":\"4.36\",\"6\":\"1.95\",\"7\":\"2\",\"8\":\"3.81\",\"9\":\"0.00\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.0\",\"15\":\"0.0\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136100\"},{\"1\":\"1\",\"2\":\"13\",\"3\":\"5.16\",\"4\":\"15.08\",\"5\":\"4.36\",\"6\":\"1.95\",\"7\":\"2\",\"8\":\"3.81\",\"9\":\"0.00\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.2\",\"15\":\"0.1\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136200\"},{\"1\":\"1\",\"2\":\"14\",\"3\":\"5.18\",\"4\":\"15.46\",\"5\":\"4.36\",\"6\":\"1.95\",\"7\":\"2\",\"8\":\"3.81\",\"9\":\"0.00\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.2\",\"15\":\"0.2\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136300\"},{\"1\":\"1\",\"2\":\"15\",\"3\":\"5.20\",\"4\":\"15.84\",\"5\":\"4.36\",\"6\":\"1.95\",\"7\":\"2\",\"8\":\"3.81\",\"9\":\"0.00\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.4\",\"15\":\"0.3\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136400\"},{\"1\":\"1\",\"2\":\"16\",\"3\":\"5.21\",\"4\":\"16.22\",\"5\":\"4.36\",\"6\":\"1.95\",\"7\":\"2\",\"8\":\"3.81\",\"9\":\"0.00\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.5\",\"15\":\"0.4\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136500\"},{\"1\":\"1\",\"2\":\"17\",\"3\":\"5.23\",\"4\":\"16.60\",\"5\":\"4.36\",\"6\":\"1.95\",\"7\":\"2\",\"8\":\"3.81\",\"9\":\"-0.03\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"0\",\"14\":\"2005-04-13 15:58:56.5\",\"15\":\"0.5\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"1113433136600\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n## Visualization with one vehicle\n\nCool! We are almost done with transforming our dataset. It is time to do some visualization. The last transformation we learn is to filter the data to keep only one vehicle:  \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_R_veh <- data_R |> \n  dplyr::filter(vehicle_id == \"2\")\n```\n:::\n\n\nAnd now we use `ggplot2` to create a plot of velocity over time. Subject vehicle in blue and preceding vehicle in orange.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nggplot(data = data_R_veh) +\n  geom_path(mapping = aes(x = time, y = v_vel), color = \"blue\") +\n  geom_path(mapping = aes(x = time, y = preceding_vel), color = \"orange\") +\n  labs(x = \"Time (s)\", y = \"Velocity (m/s)\",\n       title = \"Velocity of vehicle # 2 and its preceding vehicle\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](transform_r_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nAs you see, the lead vehicle speed is not seen after about 17 seconds. This is because the lead vehicle changed lanes.  This can also be seen in this animation:  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gganimate)\nggplot(data = data_R_veh) +\n  geom_rect(aes(fill = \"Preceding Veh\", \n                xmin = preceding_local_y - preceding_length,\n                xmax = preceding_local_y,\n                ymin = preceding_local_x - (preceding_width/2),\n                ymax = preceding_local_x + (preceding_width/2))) +\n  geom_rect(aes(fill = \"Subject Veh\",\n                xmin = local_y - v_length,\n                xmax = local_y,\n                ymin = local_x - (v_width/2),\n                ymax = local_x + (v_width/2))) +\n  geom_hline(yintercept = 3.6, linetype = \"longdash\") +\n  coord_fixed(ratio=3.5) +\n  labs(fill = NULL) +\n  theme_minimal() + \n  theme(legend.position = \"none\") +\n  transition_reveal(time)\n```\n:::\n\n\n![](car_following.gif)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}